# Lives System Skript
# Sleduje poƒçet ≈æivot≈Ø hr√°ƒç≈Ø a doƒçasnƒõ je banuje po t≈ôech √∫mrt√≠ch

# Promƒõnn√©
options:
    prefix: &8[&c≈Ωivoty&8] &r
    # Nastaven√≠ Discord kan√°lu, kam se budou pos√≠lat ozn√°men√≠ - p≈ô√≠mo Channel ID
    discord-channel-id: "1360974208456196096"

# Nastaven√≠ poƒçtu ≈æivot≈Ø p≈ôi prvn√≠m p≈ôipojen√≠
on first join:
    # UUID jsou nyn√≠ objekty, ale to by nemƒõlo ovlivnit z√°kladn√≠ pou≈æit√≠
    set {lives::%player's uuid%} to 3
    send "{@prefix} &aV√≠tej! M√°≈° &2%{lives::%player's uuid%}% &a≈æivot≈Ø."

# Zobrazen√≠ ≈æivot≈Ø p≈ôi p≈ôipojen√≠
on join:
    if {lives::%player's uuid%} is not set:
        set {lives::%player's uuid%} to 3
    
    set {_livesColor} to ""
    if {lives::%player's uuid%} is 3:
        set {_livesColor} to "&2" # Zelen√° pro 3 ≈æivoty
    else if {lives::%player's uuid%} is 2:
        set {_livesColor} to "&6" # Oran≈æov√° pro 2 ≈æivoty
    else if {lives::%player's uuid%} is 1:
        set {_livesColor} to "&c" # ƒåerven√° pro 1 ≈æivot
    
    send "{@prefix} &aAktu√°lnƒõ m√°≈° %{_livesColor}%%{lives::%player's uuid%}% &a≈æivot≈Ø."
    
    # Nastaven√≠ tab listu - zobrazen√≠ poƒçtu ≈æivot≈Ø
    updateTabList(player)

# P≈ô√≠kaz pro zobrazen√≠ ≈æivot≈Ø
command /zivoty:
    trigger:
        set {_livesColor} to ""
        if {lives::%player's uuid%} is 3:
            set {_livesColor} to "&2" # Zelen√° pro 3 ≈æivoty
        else if {lives::%player's uuid%} is 2:
            set {_livesColor} to "&6" # Oran≈æov√° pro 2 ≈æivoty
        else if {lives::%player's uuid%} is 1:
            set {_livesColor} to "&c" # ƒåerven√° pro 1 ≈æivot
        
        send "{@prefix} &aTvoje ≈æivoty: %{_livesColor}%%{lives::%player's uuid%}%"

# Sn√≠≈æen√≠ poƒçtu ≈æivot≈Ø p≈ôi smrti
on death:
    # Zajist√≠me, ≈æe hr√°ƒç m√° nastavenou promƒõnnou
    if {lives::%victim's uuid%} is not set:
        set {lives::%victim's uuid%} to 3
    
    # Sn√≠≈æ√≠me poƒçet ≈æivot≈Ø bez ohledu na to, kdo nebo co hr√°ƒçe zabilo
    remove 1 from {lives::%victim's uuid%}
    
    # Z√≠sk√°me spr√°vnou barvu podle zb√Ωvaj√≠c√≠ch ≈æivot≈Ø
    set {_livesColor} to ""
    if {lives::%victim's uuid%} is 2:
        set {_livesColor} to "&6"
    else if {lives::%victim's uuid%} is 1:
        set {_livesColor} to "&c"
    else if {lives::%victim's uuid%} is 0:
        set {_livesColor} to "&4"
    
    # Zobraz√≠me zb√Ωvaj√≠c√≠ ≈æivoty hr√°ƒçi
    send "{@prefix} &cZem≈ôel jsi! Zb√Ωv√° ti %{_livesColor}%%{lives::%victim's uuid%}% &c≈æivot≈Ø." to victim
    
    # Kdy≈æ dojdou ≈æivoty
    if {lives::%victim's uuid%} is 0:
        # Generov√°n√≠ opravdu n√°hodn√©ho ƒçasu banu v rozmez√≠ 0-10 hodin
        
        # N√°hodn√Ω celkov√Ω ƒças v sekund√°ch (0-10 hodin)
        set {_totalSeconds} to random integer between 0 and 36000 # 10 hodin = 36000 sekund
        
        # V√Ωpoƒçet hodin, minut a sekund z celkov√©ho ƒçasu
        set {_hours} to floor({_totalSeconds} / 3600)
        set {_remainingSeconds} to {_totalSeconds} - ({_hours} * 3600) # Oprava: nahrazen√≠ mod oper√°toru odƒç√≠t√°n√≠m
        set {_minutes} to floor({_remainingSeconds} / 60)
        set {_seconds} to {_remainingSeconds} - ({_minutes} * 60) # Oprava: nahrazen√≠ mod oper√°toru odƒç√≠t√°n√≠m
        
        # Vytvo≈ô√≠me ƒçasov√Ω form√°t podle po≈æadavk≈Ø tempban p≈ô√≠kazu
        set {_formattedTime} to ""
        if {_hours} is greater than 0:
            set {_formattedTime} to "%{_formattedTime}%%{_hours}%h"
        if {_minutes} is greater than 0:
            if {_formattedTime} is not "":
                set {_formattedTime} to "%{_formattedTime}% "
            set {_formattedTime} to "%{_formattedTime}%%{_minutes}%m"
        
        # Oprava: rozdƒõlen√≠ slo≈æit√© podm√≠nky na v√≠ce jednodu≈°≈°√≠ch
        if {_seconds} is greater than 0:
            if {_formattedTime} is not "":
                set {_formattedTime} to "%{_formattedTime}% "
            set {_formattedTime} to "%{_formattedTime}%%{_seconds}%s"
        else if {_hours} is 0:
            if {_minutes} is 0:
                set {_formattedTime} to "1s" # Minim√°ln√≠ ban 1 sekunda
        
        # Vytvo≈ô√≠me ƒçiteln√Ω form√°t pro zobrazen√≠ v ozn√°men√≠
        set {_readableTime} to ""
        if {_hours} is greater than 0:
            if {_hours} is 1:
                set {_readableTime} to "%{_readableTime}%%{_hours}% hodina"
            else if {_hours} is 2, 3 or 4:
                set {_readableTime} to "%{_readableTime}%%{_hours}% hodiny"
            else:
                set {_readableTime} to "%{_readableTime}%%{_hours}% hodin"
            
            # Oprava: rozdƒõlen√≠ slo≈æit√© podm√≠nky
            if {_minutes} is greater than 0:
                set {_readableTime} to "%{_readableTime}%, "
            else if {_seconds} is greater than 0:
                set {_readableTime} to "%{_readableTime}%, "
        
        if {_minutes} is greater than 0:
            if {_minutes} is 1:
                set {_readableTime} to "%{_readableTime}%%{_minutes}% minuta"
            else if {_minutes} is 2, 3 or 4:
                set {_readableTime} to "%{_readableTime}%%{_minutes}% minuty"
            else:
                set {_readableTime} to "%{_readableTime}%%{_minutes}% minut"
            
            if {_seconds} is greater than 0:
                set {_readableTime} to "%{_readableTime}% a "
        
        # Oprava: rozdƒõlen√≠ slo≈æit√© podm√≠nky
        if {_seconds} is greater than 0:
            if {_seconds} is 1:
                set {_readableTime} to "%{_readableTime}%%{_seconds}% sekunda"
            else if {_seconds} is 2, 3 or 4:
                set {_readableTime} to "%{_readableTime}%%{_seconds}% sekundy"
            else:
                set {_readableTime} to "%{_readableTime}%%{_seconds}% sekund"
        else if {_hours} is 0:
            if {_minutes} is 0:
                set {_readableTime} to "1 sekunda" # Minim√°ln√≠ ban 1 sekunda
        
        # Ban hr√°ƒçe - pou≈æ√≠v√°me spr√°vn√Ω form√°t pro tempban
        wait 2 ticks
        execute console command "tempban %victim% %{_formattedTime}% Vyƒçerpal jsi v≈°echny ≈æivoty! Ban na: %{_readableTime}%"
        
        # Resetov√°n√≠ ≈æivot≈Ø pro p≈ô√≠≈°t√≠ p≈ôihl√°≈°en√≠ - nastaveno na 1 m√≠sto 3
        set {lives::%victim's uuid%} to 1
        
        # Ozn√°men√≠ v≈°em hr√°ƒç≈Øm
        broadcast "{@prefix} &4%victim% &cztratil v≈°echny ≈æivoty a byl doƒçasnƒõ banov√°n na &4%{_readableTime}%&c!"
        
        # Poslat ozn√°men√≠ na Discord pomoc√≠ p≈ô√≠kazu (kompatibiln√≠ zp≈Øsob)
        set {_discordLoaded} to false
        loop all plugins:
            if loop-value is "DiscordSRV":
                set {_discordLoaded} to true
                
        if {_discordLoaded} is true:
            # Odesl√°n√≠ zpr√°vy na Discord pomoc√≠ spr√°vn√©ho p≈ô√≠kazu podle dokumentace
            set {_discordMessage} to "üíÄ **%victim%** ztratil v≈°echny ≈æivoty! üî® Doƒçasn√Ω ban na: **%{_readableTime}%** ‚è∞"
            execute console command "discord broadcast #server-bany %{_discordMessage}%"
            
            # Log do konzole
            log "[HardcoreLives] Odesl√°no ozn√°men√≠ o banu hr√°ƒçe %victim% na Discord server" to "plugins/Skript/logs/hardcore-lives.log"
        
        # Log warning pokud DiscordSRV nen√≠ nainstalov√°n
        if {_discordLoaded} is false:
            log "[HardcoreLives] VAROV√ÅN√ç: DiscordSRV nen√≠ nainstalov√°n nebo naƒçten, ozn√°men√≠ nebylo odesl√°no" to "plugins/Skript/logs/hardcore-lives.log"
    
    # Kdy≈æ hr√°ƒç ztrat√≠ ≈æivot, aktualizujeme jeho tab
    if {lives::%victim's uuid%} is greater than 0:
        wait 1 tick
        updateTabList(victim)

# P≈ôid√°n√≠ ≈æivota po snƒõden√≠ zlat√©ho jablka
on consume:
    # Kontrola, zda hr√°ƒç snƒõdl zlat√© jablko nebo oƒçarovan√© zlat√© jablko
    if event-item is a golden apple:
        # Kontrola, zda hr√°ƒç m√° m√©nƒõ ne≈æ 3 ≈æivoty
        if {lives::%player's uuid%} is less than 3:
            # P≈ôid√°n√≠ jednoho ≈æivota
            add 1 to {lives::%player's uuid%}
            
            # Nastaven√≠ barvy podle nov√©ho poƒçtu ≈æivot≈Ø
            set {_livesColor} to ""
            if {lives::%player's uuid%} is 3:
                set {_livesColor} to "&2" # Zelen√° pro 3 ≈æivoty
            else if {lives::%player's uuid%} is 2:
                set {_livesColor} to "&6" # Oran≈æov√° pro 2 ≈æivoty
            
            # Ozn√°men√≠ hr√°ƒçi o z√≠sk√°n√≠ ≈æivota
            send "{@prefix} &aZ√≠skal jsi jeden ≈æivot za snƒõden√≠ zlat√©ho jablka! Nyn√≠ m√°≈° %{_livesColor}%%{lives::%player's uuid%}% &a≈æivot≈Ø."
            
            # P≈ôid√°n√≠ zvukov√©ho efektu
            play sound "entity.player.levelup" with volume 1 and pitch 1.5 at player's location for player
            
            # Aktualizace tab listu po p≈ôid√°n√≠ ≈æivota
            updateTabList(player)
        else:
            # Pokud ji≈æ m√° maxim√°ln√≠ poƒçet ≈æivot≈Ø
            send "{@prefix} &eU≈æ m√°≈° maxim√°ln√≠ poƒçet ≈æivot≈Ø (3), dal≈°√≠ ≈æivoty nem≈Ø≈æe≈° z√≠skat."
    else if event-item is an enchanted golden apple:
        # Kontrola, zda hr√°ƒç m√° m√©nƒõ ne≈æ 3 ≈æivoty
        if {lives::%player's uuid%} is less than 3:
            # P≈ôid√°n√≠ jednoho ≈æivota
            add 1 to {lives::%player's uuid%}
            
            # Nastaven√≠ barvy podle nov√©ho poƒçtu ≈æivot≈Ø
            set {_livesColor} to ""
            if {lives::%player's uuid%} is 3:
                set {_livesColor} to "&2" # Zelen√° pro 3 ≈æivoty
            else if {lives::%player's uuid%} is 2:
                set {_livesColor} to "&6" # Oran≈æov√° pro 2 ≈æivoty
            
            # Ozn√°men√≠ hr√°ƒçi o z√≠sk√°n√≠ ≈æivota
            send "{@prefix} &aZ√≠skal jsi jeden ≈æivot za snƒõden√≠ oƒçarovan√©ho zlat√©ho jablka! Nyn√≠ m√°≈° %{_livesColor}%%{lives::%player's uuid%}% &a≈æivot≈Ø."
            
            # P≈ôid√°n√≠ zvukov√©ho efektu
            play sound "entity.player.levelup" with volume 1 and pitch 1.5 at player's location for player
            
            # Aktualizace tab listu po p≈ôid√°n√≠ ≈æivota
            updateTabList(player)
        else:
            # Pokud ji≈æ m√° maxim√°ln√≠ poƒçet ≈æivot≈Ø
            send "{@prefix} &eU≈æ m√°≈° maxim√°ln√≠ poƒçet ≈æivot≈Ø (3), dal≈°√≠ ≈æivoty nem≈Ø≈æe≈° z√≠skat."

# P≈ô√≠kaz pro adminy na obnoven√≠ ≈æivot≈Ø hr√°ƒçi
command /resetlives [<player>]:
    permission: lives.admin
    permission message: {@prefix} &cNem√°≈° opr√°vnƒõn√≠ pou≈æ√≠t tento p≈ô√≠kaz!
    usage: /resetlives <hr√°ƒç>
    trigger:
        if arg-1 is set:
            set {lives::%arg-1's uuid%} to 3
            send "{@prefix} &a≈Ωivoty hr√°ƒçe %arg-1% byly obnoveny na 3."
            send "{@prefix} &aAdministr√°tor ti obnovil ≈æivoty na 3." to arg-1
            
            # Aktualizace tab listu
            if arg-1 is online:
                updateTabList(arg-1)
        else:
            send "{@prefix} &cMus√≠≈° zadat jm√©no hr√°ƒçe!"

# P≈ô√≠kaz pro adminy na nastaven√≠ poƒçtu ≈æivot≈Ø
command /setlives [<player>] [<integer>]:
    permission: lives.admin
    permission message: {@prefix} &cNem√°≈° opr√°vnƒõn√≠ pou≈æ√≠t tento p≈ô√≠kaz!
    usage: /setlives <hr√°ƒç> <poƒçet>
    trigger:
        if arg-1 is set:
            if arg-2 is set:
                if arg-2 is between 0 and 3:
                    set {lives::%arg-1's uuid%} to arg-2
                    send "{@prefix} &aNastavil jsi %arg-2% ≈æivot≈Ø hr√°ƒçi %arg-1%."
                    send "{@prefix} &aPoƒçet tv√Ωch ≈æivot≈Ø byl nastaven na %arg-2%." to arg-1
                    
                    # Aktualizace tab listu
                    if arg-1 is online:
                        updateTabList(arg-1)
                else:
                    send "{@prefix} &cPoƒçet ≈æivot≈Ø mus√≠ b√Ωt mezi 0 a 3!"
            else:
                send "{@prefix} &cMus√≠≈° zadat poƒçet ≈æivot≈Ø!"
        else:
            send "{@prefix} &cMus√≠≈° zadat jm√©no hr√°ƒçe!"

# Funkce pro aktualizaci tab listu
function updateTabList(p: player):
    set {_uuid} to uuid of {_p}
    set {_livesColor} to ""
    if {lives::%{_uuid}%} is 3:
        set {_livesColor} to "&2" # Zelen√° pro 3 ≈æivoty
    else if {lives::%{_uuid}%} is 2:
        set {_livesColor} to "&6" # Oran≈æov√° pro 2 ≈æivoty
    else if {lives::%{_uuid}%} is 1:
        set {_livesColor} to "&c" # ƒåerven√° pro 1 ≈æivot
    
    # Nastaven√≠ prefixu nebo suffixu v tab listu (z√°le≈æ√≠ na verzi serveru a pluginu)
    set tab list name of {_p} to "%{_p}% %{_livesColor}%[%{lives::%{_uuid}%}%&f]"

# P≈ô√≠kaz pro test Discord integrace (pouze pro adminy)
command /testdiscord:
    permission: lives.admin
    permission message: {@prefix} &cNem√°≈° opr√°vnƒõn√≠ pou≈æ√≠t tento p≈ô√≠kaz!
    trigger:
        # Kontrola, zda je plugin DiscordSRV naƒçten
        set {_discordLoaded} to false
        loop all plugins:
            if loop-value is "DiscordSRV":
                set {_discordLoaded} to true
                
        if {_discordLoaded} is true:
            send "{@prefix} &aOdes√≠l√°m testovac√≠ zpr√°vu na Discord..."
            
            # Testovac√≠ zpr√°va
            set {_testMessage} to "üîî **Testovac√≠ zpr√°va z Minecraft serveru.** Hardcore Lives System je p≈ôipojen k Discordu!"
            
            # Odesl√°n√≠ testovac√≠ zpr√°vy pomoc√≠ DiscordSRV p≈ô√≠kazu s ID kan√°lu
            execute console command "discord broadcast #server-bany %{_testMessage}%"
            
            send "{@prefix} &aZpr√°va byla odesl√°na. Zkontrolujte Discord kan√°l."
        else:
            send "{@prefix} &cPlugin DiscordSRV nen√≠ nainstalov√°n nebo nen√≠ naƒçten!"

# Aktualizace v≈°ech hr√°ƒç≈Ø p≈ôi naƒçten√≠ skriptu
on skript load:
    loop all players:
        updateTabList(loop-player)

# Opravit tab list ka≈æd√Ωch 5 minut (pro p≈ô√≠pad, ≈æe by do≈°lo k de-synchronizaci)
every 5 minutes:
    loop all players:
        updateTabList(loop-player)